<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV</title>
    <link rel="icon" href="../assets/images/sword.jpg" type="image/jpg">
    <link rel="stylesheet" href="/css/style_bio.css">
    <link rel="stylesheet" href="https://use.typekit.net/iip6ucd.css">
    <link rel="stylesheet" href="/css/addon.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/DRACOLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>
    <style>
        body,
        button,
        a,
        tspan,
        * {
            font-family: 'HIDESerif', serif !important;
        }

        .navigation_container,
        .image_container,
        #pdf-viewer-overlay {
            position: relative;
            z-index: 10;
        }

        #pdf-viewer-overlay > .pdf-modal {
            position: relative;
            max-width: 90vw;
            max-height: 90vh;
            margin: auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 0 16px 0;
            /* 不要 box-shadow 了 */
        }

        #pdf-viewer {
            background: #fff;
            border-radius: 12px;
            overflow: auto;
            max-width: 80vw;
            max-height: 60vh;
            padding: 12px;
            text-align: center;
            margin: 0 auto;
            box-shadow: 0 0 32px 4px #ff2222;
            /* 红色发光只在PDF区域 */
        }

        /* zoom system */
        :root { --zoom: 1; }
        html { font-size: calc(100% * var(--zoom)); transition: background-color .3s ease, filter .3s ease; }
        body { transition: background-color .3s ease, filter .3s ease; }
        /* tint when zoomed in or out */
        body.zoom-tint { background-color: #fff6f8 !important; filter: hue-rotate(8deg) saturate(1.06); }
        body.zoom-cool { background-color: #f2f9ff !important; filter: hue-rotate(-8deg) saturate(1.02); }

        /* controls overlay (copied style from about, minimal) */
        #controls {
          position: fixed; right: 16px; bottom: 16px; z-index: 10000;
          border: 1px solid #ddd; background: #ffffffd9; padding: 8px 12px; border-radius: 999px;
          cursor: pointer; user-select: none; font-family: 'HIDESerif', serif;
          box-shadow: 0 6px 18px rgba(0,0,0,.06);
        }
        #controls span { font-size: .95rem; color: #333; }
        #controls:hover { background: #fff; }

        /* xin-message (same block as about, but visible here) */
        #xin-message {
          position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
          font-size: 1.2rem; color: #ffbacb; font-weight: bold; padding: 0.08em 0.35em;
          border-radius: 0.5em; display: block; z-index: 10000; text-align: center; background: none;
          text-shadow: 0 0 212px #ff2222, 0 0 0px #ff2222, 1px 1px 0 #ff2222, 0 12px 314px #ff2222;
        }
        @media only screen and (max-width: 600px) {
          #xin-message { font-size: .9rem; }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
</head>

<body>
    <div class="navigation_container">
        <a href="index.html">
            <:::::::::::::::::}] back </a>
        <span></span>
        <span></span>
    </div>
    <div class="image_container">
        <div class="text_grid">


            <div class="row1_new">
                <div class="column1_new">

                    <b style="color: grey;">
                        <a href="https://drive.google.com/drive/folders/15xvC7bqS-wTGAObbOAuqc9EKpL5sUjfN?usp=sharing"
                            class="cv-link" target="_blank" style="margin-top: 2.5em; display: inline-block;">
                            *CV download link
                        </a>
                    </b><br>

                </div>
                <!--- <img src="bio.png" alt="About Image" style="opacity: 0.3;">-->

            </div>
            <div id="loading">loading...</div>

                <span></span>
            </div>
            <!-- 3D 渲染 -->
            <script type="module" src="./js/about.js"></script>


            <script>
                let pdfDoc = null,
                    pageNum = 1,
                    pageRendering = false,
                    pageNumPending = null,
                    scale = 1.2,
                    canvas = null,
                    ctx = null;

                function renderPage(num) {
                    pageRendering = true;
                    pdfDoc.getPage(num).then(function (page) {
                        let viewport = page.getViewport({ scale: scale });
                        // 始终只保留一个canvas
                        let viewer = document.getElementById('pdf-viewer');
                        let canvas = viewer.querySelector('canvas');
                        if (!canvas) {
                            canvas = document.createElement('canvas');
                            viewer.innerHTML = '';
                            viewer.appendChild(canvas);
                        }
                        let ctx = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;

                        let renderContext = {
                            canvasContext: ctx,
                            viewport: viewport
                        };
                        let renderTask = page.render(renderContext);

                        renderTask.promise.then(function () {
                            pageRendering = false;
                            document.getElementById('page-num').textContent = pageNum;
                            if (pageNumPending !== null) {
                                renderPage(pageNumPending);
                                pageNumPending = null;
                            }
                        });
                    });
                }

                function queueRenderPage(num) {
                    if (pageRendering) {
                        pageNumPending = num;
                    } else {
                        renderPage(num);
                    }
                }

                function onPrevPage() {
                    if (pageNum <= 1) return;
                    pageNum--;
                    queueRenderPage(pageNum);
                }
                function onNextPage() {
                    if (pageNum >= pdfDoc.numPages) return;
                    pageNum++;
                    queueRenderPage(pageNum);
                }

                document.getElementById('cv-view-btn').onclick = function () {
                    document.getElementById('pdf-viewer-overlay').style.display = 'flex';
                    document.getElementById('pdf-viewer').innerHTML = '';
                    canvas = null;
                    pageNum = 1;
                    pdfjsLib.getDocument('cv.pdf').promise.then(function (pdfDoc_) {
                        pdfDoc = pdfDoc_;
                        document.getElementById('page-count').textContent = pdfDoc.numPages;
                        renderPage(pageNum);
                    });
                };

                document.getElementById('close-pdf-viewer').onclick = function () {
                    document.getElementById('pdf-viewer-overlay').style.display = 'none';
                };

                document.getElementById('prev-page').onclick = onPrevPage;
                document.getElementById('next-page').onclick = onNextPage;
            </script>
        </div> <!-- 关闭 .column1_new -->
    </div> <!-- 关闭 .row1_new -->
</div> <!-- 关闭 .text_grid -->
</div> <!-- 关闭 .image_container -->

<!-- PDF 预览浮层放在这里！ -->
<div id="pdf-viewer-overlay"
    style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(255,255,255,0.92); z-index:9999; justify-content:center; align-items:center;">
    <div class="pdf-modal" style="display: flex; flex-direction: column; align-items: center; position: relative; max-width: 90vw; max-height: 90vh; background: rgba(255,255,255,0.98); border-radius: 18px; box-shadow: 0 0 32px 4px #ff2222;">
        <button id="close-pdf-viewer"
            style="position:absolute; top:8px; right:16px; z-index:2; background:none; border:none; color:#ff2222; font-size:1.5rem; cursor:pointer;">×</button>
        <div class="pdf-toolbar" style="text-align:center; margin: 32px 0 12px 0;">
            <button id="prev-page" style="margin-right:16px;">‹</button>
            <span id="page-num">1</span> / <span id="page-count">1</span>
            <button id="next-page" style="margin-left:16px;">›</button>
        </div>
        <div id="pdf-viewer" style="background:#fff; border-radius:12px; overflow:auto; max-width:80vw; max-height:60vh; padding:12px; text-align:center; margin:0 auto; box-shadow: 0 0 32px 4px #ff2222;">
        </div>
    </div>
</div>

<!-- Controls overlay (same as about) -->
<div id="controls"><span>zoom</span></div>

<!-- xin-message (same as about) -->
<div id="xin-message" style="cursor:pointer;">
    hi, i’m xin!<br> Ask me to send you my portfolio ^0^ hire me!!
</div>
<script>
    // open IG on click
    document.getElementById('xin-message')?.addEventListener('click', function () {
        window.open('https://www.instagram.com/songxin.xin/', '_blank');
    });

    // zoom/tint logic
    (function () {
        let zoom = 1;
        const clamp = (v, a, b) => Math.min(b, Math.max(a, v));
        const apply = () => {
            document.documentElement.style.setProperty('--zoom', zoom.toFixed(2));
            document.body.classList.toggle('zoom-tint', zoom > 1.01);
            document.body.classList.toggle('zoom-cool', zoom < 0.99);
            if (zoom >= 0.99 && zoom <= 1.01) {
                document.body.classList.remove('zoom-tint');
                document.body.classList.remove('zoom-cool');
            }
        };
        apply();

        // click control: quick toggle
        document.getElementById('controls')?.addEventListener('click', () => {
            zoom = (zoom < 1.2) ? 1.33 : 1;
            apply();
        });

        // keyboard: Cmd/Ctrl + +/-/0
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                if (e.key === '=' || e.key === '+') { e.preventDefault(); zoom = clamp(zoom + 0.1, 0.8, 1.8); apply(); }
                else if (e.key === '-' || e.key === '_') { e.preventDefault(); zoom = clamp(zoom - 0.1, 0.8, 1.8); apply(); }
                else if (e.key === '0') { e.preventDefault(); zoom = 1; apply(); }
            }
        });
    })();
</script>

<!-- ASCII cursor -->
<style>
    .ascii-cursor { position: fixed; pointer-events: none; top: 0; left: 0; opacity: 0; white-space: pre; z-index: 9999; }
</style>
<pre id="ascii-cursor" class="ascii-cursor" aria-hidden="true">(\___/)
 \* */
  \ /
   ¤    </pre>
<script>
    (function () {
        const el = document.getElementById('ascii-cursor');
        if (!el) return;
        const frameOpen = ["(\\___/)", " \\* */", "  \\ /", "   ¤    "].join("\n");
        const frameBlink = ["(\\___/)", " \\^ ^/", "  \\ /", "   *    "].join("\n");
        el.textContent = frameOpen;
        function doBlinkOnce(){ el.textContent = frameBlink; setTimeout(()=>{ el.textContent = frameOpen; },120); }
        (function schedule(){
            setTimeout(()=>{
                if (Math.random() < 0.5) { doBlinkOnce(); setTimeout(doBlinkOnce,180); } else { doBlinkOnce(); }
                schedule();
            }, 800 + Math.random()*1800);
        })();
        const move = (e)=>{ el.style.left = e.clientX+'px'; el.style.top = e.clientY+'px'; el.style.opacity = '1'; };
        document.addEventListener('mousemove', move);
        document.addEventListener('mouseleave', ()=>{ el.style.opacity = '0'; });
        document.addEventListener('mouseenter', ()=>{ el.style.opacity = '1'; });
    })();
</script>
</body>
</html>